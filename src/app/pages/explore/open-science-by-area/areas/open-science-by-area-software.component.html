<div page-content [fullWidth]="true">
  <div actions class="uk-section-primary uk-preserve-color">
    <sidebar-mobile-toggle class="uk-hidden@m uk-display-block uk-padding-small"></sidebar-mobile-toggle>
  </div>
  <div inner>
    <div class="uk-section uk-section-primary uk-preserve-color uk-section-small" #exportContent>
      <div class="uk-container">

        <div class="uk-flex uk-flex-between uk-flex-middle uk-visible@m">
          <h4>Open Science by Area / Open Software</h4>
          <div class="uk-flex uk-flex-center"
               (click)="exportToPDF([exportContent, exportContent1, exportContent2, exportContent3], 'Open Software')"
               style="cursor: pointer">
            <div class="uk-flex uk-flex-middle uk-text-primary" style="background-color: #DAEEF3; border-radius: 30px; padding: 5px 7px">
              <span class="" style="background-color: #fff; border-radius: 50px; border: 1px solid #008691; padding: 4px 10px">
                Export report
              </span>
              <span *ngIf="exportActive else elseBlock" class="uk-margin-small-left" data-uk-spinner="ratio: 0.7"></span>
              <ng-template #elseBlock>
                <span class="material-symbols-outlined filled uk-margin-small-left uk-text-primary">download</span>
              </ng-template>
            </div>
          </div>
        </div>

        <div class="uk-hidden@m">
          <h4>Open Science by Area / Open Software</h4>
          <div class="uk-flex uk-flex-right"
               (click)="exportToPDF([exportContent, exportContent1, exportContent2, exportContent3], 'Open Software')"
               style="cursor: pointer">
            <div class="uk-flex uk-flex-middle uk-text-primary" style="background-color: #DAEEF3; border-radius: 30px; padding: 5px 7px">
              <span class="" style="background-color: #fff; border-radius: 50px; border: 1px solid #008691; padding: 4px 10px">
                Export report
              </span>
              <span *ngIf="exportActive else elseBlock" class="uk-margin-small-left" data-uk-spinner="ratio: 0.7"></span>
              <ng-template #elseBlock>
                <span class="material-symbols-outlined filled uk-margin-small-left uk-text-primary">download</span>
              </ng-template>
            </div>
          </div>
        </div>

        <!--    <h5>Open Software</h5>-->
        <p class="uk-text-lead uk-text-justify">Open Software is a vital component of Open Science, enabling key
          stakeholders to access, modify, and share tools that drive innovation and collaboration in research. It
          fosters transparency, reproducibility, and interoperability across scientific disciplines. This page provides
          an overview of Open Software initiatives in Europe, including data on policies, financial investments, and
          strategies from the Survey on National Contributions to EOSC and Open Science.</p>

      </div>
    </div>

    <div class="uk-section uk-section-primary uk-preserve-color uk-section-small" #exportContent1>
      <div class="uk-container">
        <h5>General Overview of Open Software in Europe for {{ year }}</h5>

        <div class="uk-child-width-1-3@m uk-child-width-1-3@l uk-child-width-1-1@s uk-grid-match uk-grid-row-medium uk-flex-center" data-uk-grid>

          <div *ngIf="sets.length === 2">
            <div class="uk-card card-simple uk-card-small uk-card-body">
              <div>
                <p>Open Software sets published in EU Countries</p>
              </div>
              <div class="number big uk-margin-medium-top">
                <span class="uk-text-bold">{{ sets[1] }} sets</span>
              </div>
              <div class="uk-flex uk-flex-bottom uk-flex-between uk-width-1-1">
                <ng-container *ngIf="sets[1] >= sets[0]; else setsDown">
                  <div class="uk-flex uk-flex-middle">
                    <span class="material-symbols-outlined up-arrow-color">arrow_upward</span>
                    <span class="percentage-up-color">+{{ calculatePercentageChange(sets) }}%</span>&nbsp; from last year
                  </div>
                  <div>
                    <img ngSrc="../assets/images/explore/trend_green.svg" alt="Upward trend line" height="50"
                         width="99">
                  </div>
                </ng-container>
                <ng-template #setsDown>
                  <div class="uk-flex uk-flex-middle">
                    <span class="material-symbols-outlined down-arrow-color">arrow_downward</span>
                    <span class="percentage-down-color">-{{ calculatePercentageChange(sets) }}%</span>&nbsp; from last
                    year
                  </div>
                  <div>
                    <img ngSrc="../assets/images/explore/trend_red.svg" alt="Downward trend line" height="50"
                         width="99">
                  </div>
                </ng-template>
              </div>
            </div>
          </div>

          <div *ngIf="countriesWithPolicy.length === 2">
            <div class="uk-card card-simple uk-card-small uk-card-body">
              <div>
                <p>EU Countries with Policy on Open Software</p>
              </div>
              <div class="number big uk-margin-medium-top">
                <span class="uk-text-bold">{{ countriesWithPolicy[1] }}%</span>
              </div>
              <div class="uk-flex uk-flex-bottom uk-flex-between uk-width-1-1">
                <ng-container *ngIf="countriesWithPolicy[1] >= countriesWithPolicy[0]; else policyDown">
                  <div class="uk-flex uk-flex-middle">
                    <span class="material-symbols-outlined up-arrow-color">arrow_upward</span>
                    <span class="percentage-up-color">+{{ Math.abs(countriesWithPolicy[0] - countriesWithPolicy[1]) }}
                      %</span>&nbsp; from last year
                  </div>
                  <div>
                    <img ngSrc="../assets/images/explore/trend_green.svg" alt="Upward trend line" height="50"
                         width="99">
                  </div>
                </ng-container>
                <ng-template #policyDown>
                  <div class="uk-flex uk-flex-middle">
                    <span class="material-symbols-outlined down-arrow-color">arrow_downward</span>
                    <span class="percentage-down-color">-{{ Math.abs(countriesWithPolicy[0] - countriesWithPolicy[1]) }}
                      %</span>&nbsp; from last year
                  </div>
                  <div>
                    <img ngSrc="../assets/images/explore/trend_red.svg" alt="Downward trend line" height="50"
                         width="99">
                  </div>
                </ng-template>
              </div>
            </div>
          </div>

          <div *ngIf="totalInvestments.length === 2">
            <div class="uk-card card-simple uk-card-small uk-card-body">
              <div>
                <p>Financial investments in Open Software</p>
              </div>
              <div class="number big uk-margin-medium-top">
                <span class="uk-text-bold">{{ totalInvestments[1] }} mil Euro</span>
              </div>
              <div class="uk-flex uk-flex-bottom uk-flex-between uk-width-1-1">
                <ng-container *ngIf="totalInvestments[1] >= totalInvestments[0]; else investmentsDown">
                  <div class="uk-flex uk-flex-middle">
                    <span class="material-symbols-outlined up-arrow-color">arrow_upward</span>
                    <span class="percentage-up-color">+{{ calculatePercentageChange(totalInvestments) }}%</span>&nbsp;
                    from last year
                  </div>
                  <div>
                    <img ngSrc="../assets/images/explore/trend_green.svg" alt="Upward trend line" height="50"
                         width="99">
                  </div>
                </ng-container>
                <ng-template #investmentsDown>
                  <div class="uk-flex uk-flex-middle">
                    <span class="material-symbols-outlined down-arrow-color">arrow_downward</span>
                    <span class="percentage-down-color">-{{ calculatePercentageChange(totalInvestments) }}%</span>&nbsp;
                    from last year
                  </div>
                  <div>
                    <img ngSrc="../assets/images/explore/trend_red.svg" alt="Downward trend line" height="50"
                         width="99">
                  </div>
                </ng-template>
              </div>
            </div>
          </div>

          <div *ngIf="countriesWithStrategy.length === 2">
            <div class="uk-card card-simple uk-card-small uk-card-body">
              <div>
                <p>EU Countries with Financial Strategy on Open Software</p>
              </div>
              <div class="number big uk-margin-medium-top">
                <span class="uk-text-bold">{{ countriesWithStrategy[1] }}%</span>
              </div>
              <div class="uk-flex uk-flex-bottom uk-flex-between uk-width-1-1">
                <ng-container *ngIf="countriesWithStrategy[1] >= countriesWithStrategy[0]; else strategyDown">
                  <div class="uk-flex uk-flex-middle">
                    <span class="material-symbols-outlined up-arrow-color">arrow_upward</span>
                    <span class="percentage-up-color">+{{ Math.abs(countriesWithStrategy[0] - countriesWithStrategy[1]) }}%</span>&nbsp; from last year
                  </div>
                  <div>
                    <img ngSrc="../assets/images/explore/trend_green.svg" alt="Upward trend line" height="50" width="99">
                  </div>
                </ng-container>
                <ng-template #strategyDown>
                  <div class="uk-flex uk-flex-middle">
                    <span class="material-symbols-outlined down-arrow-color">arrow_downward</span>
                    <span class="percentage-down-color">-{{ Math.abs(countriesWithStrategy[0] - countriesWithStrategy[1]) }}%</span>&nbsp; from last year
                  </div>
                  <div>
                    <img ngSrc="../assets/images/explore/trend_red.svg" alt="Downward trend line" height="50" width="99">
                  </div>
                </ng-template>
              </div>
            </div>
          </div>

          <div *ngIf="countriesWithMonitoring.length === 2">
            <div class="uk-card card-simple uk-card-small uk-card-body">
              <div>
                <p>EU Countries with Monitoring Initiatives on Open Software</p>
              </div>
              <div class="number big uk-margin-medium-top">
                <span class="uk-text-bold">{{ countriesWithMonitoring[1] }}%</span>
              </div>
              <div class="uk-flex uk-flex-bottom uk-flex-between uk-width-1-1">
                <ng-container *ngIf="countriesWithMonitoring[1] >= countriesWithMonitoring[0]; else monitoringDown">
                  <div class="uk-flex uk-flex-middle">
                    <span class="material-symbols-outlined up-arrow-color">arrow_upward</span>
                    <span class="percentage-up-color">+{{ Math.abs(countriesWithMonitoring[0] - countriesWithMonitoring[1]) }}%</span>&nbsp; from last year
                  </div>
                  <div>
                    <img ngSrc="../assets/images/explore/trend_green.svg" alt="Upward trend line" height="50" width="99">
                  </div>
                </ng-container>
                <ng-template #monitoringDown>
                  <div class="uk-flex uk-flex-middle">
                    <span class="material-symbols-outlined down-arrow-color">arrow_downward</span>
                    <span class="percentage-down-color">-{{ Math.abs(countriesWithMonitoring[0] - countriesWithMonitoring[1]) }}%</span>&nbsp; from last year
                  </div>
                  <div>
                    <img ngSrc="../assets/images/explore/trend_red.svg" alt="Downward trend line" height="50" width="99">
                  </div>
                </ng-template>
              </div>
            </div>
          </div>

        </div>

        <div class="uk-margin-top">
          <span class="uk-text-bold">Data source:</span>&nbsp;
          Survey on National Contributions to EOSC and Open Science {{year}} -
          showing data for {{ year }}, except financial contributions, which reflect the previous year ({{+year-1}}).
        </div>

      </div>
    </div>

    <div class="uk-section uk-section-primary uk-preserve-color uk-section-small" #exportContent2>
      <div class="uk-container">

        <div class="uk-card uk-card-default visualisation-card uk-card-body">

          <ul class="uk-subnav uk-subnav-pill" data-uk-switcher="connect:#maps; animation: uk-animation-fade">
            <li><a class="uk-margin-remove-bottom" (click)="countryName = countryCode = comment = undefined">Policies</a></li>
            <li><a class="uk-margin-remove-bottom" (click)="countryName = countryCode = comment = undefined">Monitoring</a></li>
          </ul>

          <ul id="maps" class="uk-switcher uk-child-width-1-1 uk-grid-match" data-uk-grid>
            <li>
              <div data-uk-grid>
                <div class="uk-width-2-3@m uk-width-2-3@l uk-width-1-1@s">
                  <app-highcharts-category-map
                    [mapData]="questionsDataArray[0]" [height]="700" [smallScreen]="smallScreen"
                    [title]="'National Policy on Open Source Software'" [backgroundColor]="'#ffffff'"
                    [customLabelText]="'<span class=\'uk-text-xsmall\'><strong>'+participatingCountries[0] + ' out of '+ total[0] + '</strong> countries have a <br>national policy on Open Source software</span>'"
                    [caption]="policesMapCaptions[4] + '<strong>Data source:</strong> Survey on National Contributions to EOSC and Open Science '+year+'.'"
                    (mapClick)="showComment(0, $event)">
                  </app-highcharts-category-map>
                </div>
                <div class="uk-width-1-3@m uk-width-1-3@l uk-width-1-1@s">
                  <div>
                    <h6>Start Exploring</h6>
                    <p>Click on a country to see what the survey reveals. Each one has its own story.</p>
                    <!--                <h6>Click on country for additional information</h6>-->
                    <div class="uk-flex uk-flex-middle uk-margin-medium-top">
                      <img *ngIf="countryCode" ngSrc="survey-tool/assets/images/flags/{{countryCode}}-flag-round.png"
                           width="30" height="30" alt="Rounded flag of the selected country">
                      <span *ngIf="countryName" class="uk-margin-small-left">{{ countryName }}</span>
                    </div>
                    <p *ngIf="comment; else noComment" [innerHTML]="comment"
                       class="uk-text-justify uk-text-small overflow-wrap-break-word"></p>
                    <ng-template #noComment>--</ng-template>
                  </div>
                </div>
              </div>
            </li>
            <li>
              <div data-uk-grid>
                <div class="uk-width-2-3@m uk-width-2-3@l uk-width-1-1@s">
                  <app-highcharts-category-map
                    [mapData]="questionsDataArray[1]" [height]="700" [smallScreen]="smallScreen"
                    [title]="'National Monitoring on Open Source Software'" [backgroundColor]="'#ffffff'"
                    [customLabelText]="'<span class=\'uk-text-xsmall\'><strong>'+participatingCountries[1] + ' out of '+ total[1] + '</strong> countries have a <br>national monitoring on Open Source software</span>'"
                    [caption]="monitoringMapCaptions[4] + '<strong>Data source:</strong> Survey on National Contributions to EOSC and Open Science '+year+'.'"
                    (mapClick)="showComment(1, $event)">
                  </app-highcharts-category-map>
                </div>
                <div class="uk-width-1-3@m uk-width-1-3@l uk-width-1-1@s">
                  <div>
                    <h6>Start Exploring</h6>
                    <p>Click on a country to see what the survey reveals. Each one has its own story.</p>
                    <!--                <h6>Click on country for additional information</h6>-->
                    <div class="uk-flex uk-flex-middle uk-margin-medium-top">
                      <img *ngIf="countryCode" ngSrc="survey-tool/assets/images/flags/{{countryCode}}-flag-round.png"
                           width="30" height="30" alt="Rounded flag of the selected country">
                      <span *ngIf="countryName" class="uk-margin-small-left">{{ countryName }}</span>
                    </div>
                    <p *ngIf="comment; else noComment" [innerHTML]="comment"
                       class="uk-text-justify uk-text-small overflow-wrap-break-word"></p>
                    <ng-template #noComment>--</ng-template>
                  </div>
                </div>
              </div>
            </li>
          </ul>

        </div>

      </div>
    </div>

    <div class="uk-section uk-section-primary uk-preserve-color uk-section-small" #exportContent3>
      <div class="uk-container">

        <div class="uk-card uk-card-default visualisation-card uk-card-body">

          <ul class="uk-subnav uk-subnav-pill" data-uk-switcher="connect:#investments; animation: uk-animation-fade">
            <li><a class="uk-margin-remove-bottom">Overview</a></li>
            <li><a class="uk-margin-remove-bottom">Details</a></li>
          </ul>

          <ul id="investments" class="uk-switcher">
            <li>
              <div class="">
                <app-multi-chart [series]="bar" [categories]="['Number of countries per Investment Category']"
                                 [titles]="barChartTitles" [reversedStacks]="false"
                                 [stacking]="'normal'" [pointWidth]="75" [legendOptions]="legendOptions"
                                 [customTooltip]="true" [yAxisLabels]="false" [height]="smallScreen ? 600 : 400"
                                 [caption]="'<p class=\'uk-text-justify\'>The graph illustrates the financial investments in Open-Source Software made by European countries. The investments are categorised in ranges to show the distribution and scale of funding.</p>' +
                                 '<p><strong>Data source: </strong>Survey on National Contributions to EOSC and Open Science '+year+' — for financial contributions the data reflect the previous year ('+(+year-1)+').</p>'">
                </app-multi-chart>
              </div>
            </li>
            <li>
              <div class="">
                <app-tree-graph [data]="treeGraph" style="height: 100%" [height]="700"
                                [title]="'Financial Investments in Open Sources Software in '+ (+year-1)"
                                [caption]="'<p class=\'uk-text-justify\'>The graph illustrates the financial investments in Open-Source Software made by European countries. The investments are categorised in ranges to show the distribution and scale of funding.</p>' +
                                '<p><strong>Data source: </strong>Survey on National Contributions to EOSC and Open Science '+year+' — for financial contributions the data reflect the previous year ('+(+year-1)+').</p>'">
                </app-tree-graph>
              </div>
            </li>
          </ul>

        </div>

      </div>
    </div>
  </div>
</div>

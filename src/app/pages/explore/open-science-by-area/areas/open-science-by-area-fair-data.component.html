<div page-content [fullWidth]="true">
  <div actions class="uk-section-primary uk-preserve-color">
    <sidebar-mobile-toggle class="uk-hidden@m uk-display-block uk-padding-small"></sidebar-mobile-toggle>
  </div>
  <div inner>
    <div class="uk-section uk-section-primary uk-preserve-color uk-section-small" #exportContent>
      <div class="uk-container">

        <div class="uk-flex uk-flex-between uk-flex-middle uk-visible@m">
          <h4>Open Science by Area / FAIR Data</h4>
          <div class="uk-flex uk-flex-center"
            (click)="exportToPDF([exportContent, exportContent1, exportContent2, exportContent3, exportContent4, exportContent5], 'FAIR Data')"
            style="cursor: pointer">
            <div class="uk-flex uk-flex-middle uk-text-primary" style="background-color: #DAEEF3; border-radius: 30px; padding: 5px 7px">
              <span class="" style="background-color: #fff; border-radius: 50px; border: 1px solid #008691; padding: 4px 10px">
                Export report
              </span>
              @if (exportActive) {
                <span class="uk-margin-small-left"
                data-uk-spinner="ratio: 0.7"></span>
              } @else {
                <span class="material-symbols-outlined filled uk-margin-small-left uk-text-primary">download</span>
              }
            </div>
          </div>
        </div>

        <div class="uk-hidden@m">
          <h4>Open Science by Area / FAIR Data</h4>
          <div class="uk-flex uk-flex-right"
            (click)="exportToPDF([exportContent, exportContent1, exportContent2, exportContent3, exportContent4, exportContent5], 'FAIR Data')"
            style="cursor: pointer">
            <div class="uk-flex uk-flex-middle uk-text-primary" style="background-color: #DAEEF3; border-radius: 30px; padding: 5px 7px">
              <span class="" style="background-color: #fff; border-radius: 50px; border: 1px solid #008691; padding: 4px 10px">
                Export report
              </span>
              @if (exportActive) {
                <span class="uk-margin-small-left" data-uk-spinner="ratio: 0.7"></span>
              } @else {
                <span class="material-symbols-outlined filled uk-margin-small-left uk-text-primary">download</span>
              }
            </div>
          </div>
        </div>

        <!--    <h5>FAIR Data</h5>-->
        <p class="uk-text-lead uk-text-justify">FAIR Data principles refer to guidelines that ensure data are Findable,
          Accessible, Interoperable, and Reusable. These principles aim to enhance the utility and availability of data
          generated by scientific research, promoting more efficient discovery and analysis by both humans and machines.
          The FAIR principles advocate for robust metadata and data standards, easy discoverability through persistent
          identifiers, accessible data under well-defined conditions, interoperable formats that allow integration with
        other datasets, and clear usage licenses to maximize data reuse.</p>
      </div>
    </div>

    <div class="uk-section uk-section-primary uk-preserve-color uk-section-xsmall" #exportContent1>
      <div class="uk-container">
        <h5>Monitoring FAIR Data and its challenges</h5>
        <p class="uk-text-justify">Monitoring FAIR Data is a complex task due to the evolving nature of definitions
          surrounding which datasets qualify as FAIR and which do not. As the criteria for assessing data against these
          principles are still being refined, we currently offer only a limited number of analyses on FAIR data. This
          limitation reflects the ongoing development in the understanding and implementation of the FAIR principles
          within the scientific and Data Management communities. As methodologies mature and definitions become more
          standardized, we anticipate expanding our analytical offerings to provide more comprehensive insights into
        FAIR data practices.</p>
      </div>
    </div>

    <div class="uk-section uk-section-primary uk-preserve-color uk-section-xsmall" #exportContent2>
      <div class="uk-container">
        <h5>General Overview of FAIR Data in Europe for {{ year }}</h5>

        <div class="uk-child-width-1-3@m uk-child-width-1-3@l uk-child-width-1-1@s uk-grid-match uk-grid-row-medium uk-flex-center" data-uk-grid>

          @if (countriesWithPolicy.length === 2) {
            <div>
              <div class="uk-card card-simple uk-card-small uk-card-body">
                <div>
                  <p>EU Countries with Policy on FAIR Data</p>
                </div>
                <div class="number big uk-margin-medium-top">
                  <span class="uk-text-bold">{{ countriesWithPolicy[1] }}%</span>
                </div>
                <div class="uk-flex uk-flex-bottom uk-flex-between uk-width-1-1">
                  @if (countriesWithPolicy[1] >= countriesWithPolicy[0]) {
                    <div class="uk-flex uk-flex-middle">
                      <span class="material-symbols-outlined up-arrow-color">arrow_upward</span>
                      <span class="percentage-up-color">+{{ Math.abs(countriesWithPolicy[0] - countriesWithPolicy[1]) }}
                      %</span>&nbsp; from last year
                    </div>
                    <div>
                      <img ngSrc="../assets/images/explore/trend_green.svg" alt="Upward trend line" height="50"
                        width="99">
                    </div>
                  } @else {
                    <div class="uk-flex uk-flex-middle">
                      <span class="material-symbols-outlined down-arrow-color">arrow_downward</span>
                      <span class="percentage-down-color">-{{ Math.abs(countriesWithPolicy[0] - countriesWithPolicy[1]) }}
                      %</span>&nbsp; from last year
                    </div>
                    <div>
                      <img ngSrc="../assets/images/explore/trend_red.svg" alt="Downward trend line" height="50"
                        width="99">
                    </div>
                  }
                </div>
              </div>
            </div>
          }

          @if (totalInvestments.length === 2) {
            <div>
              <div class="uk-card card-simple uk-card-small uk-card-body">
                <div>
                  <p>Financial investments in Open Data</p>
                </div>
                <div class="number big uk-margin-medium-top">
                  <span class="uk-text-bold">{{ totalInvestments[1] }} mil Euro</span>
                </div>
                <div class="uk-flex uk-flex-bottom uk-flex-between uk-width-1-1">
                  @if (totalInvestments[1] >= totalInvestments[0]) {
                    <div class="uk-flex uk-flex-middle">
                      <span class="material-symbols-outlined up-arrow-color">arrow_upward</span>
                      <span class="percentage-up-color">+{{ calculatePercentageChange(totalInvestments) }}%</span>&nbsp;
                      from last year
                    </div>
                    <div>
                      <img ngSrc="../assets/images/explore/trend_green.svg" alt="Upward trend line" height="50"
                        width="99">
                    </div>
                  } @else {
                    <div class="uk-flex uk-flex-middle">
                      <span class="material-symbols-outlined down-arrow-color">arrow_downward</span>
                      <span class="percentage-down-color">-{{ calculatePercentageChange(totalInvestments) }}%</span>&nbsp;
                      from last year
                    </div>
                    <div>
                      <img ngSrc="../assets/images/explore/trend_red.svg" alt="Downward trend line" height="50"
                        width="99">
                    </div>
                  }
                </div>
              </div>
            </div>
          }

          @if (countriesWithStrategy.length === 2) {
            <div>
              <div class="uk-card card-simple uk-card-small uk-card-body">
                <div>
                  <p>EU Countries with Financial Strategy on FAIR Data</p>
                </div>
                <div class="number big uk-margin-medium-top">
                  <span class="uk-text-bold">{{ countriesWithStrategy[1] }}%</span>
                </div>
                <div class="uk-flex uk-flex-bottom uk-flex-between uk-width-1-1">
                  @if (countriesWithStrategy[1] >= countriesWithStrategy[0]) {
                    <div class="uk-flex uk-flex-middle">
                      <span class="material-symbols-outlined up-arrow-color">arrow_upward</span>
                      <span
                        class="percentage-up-color">+{{ Math.abs(countriesWithStrategy[0] - countriesWithStrategy[1]) }}
                      %</span>&nbsp; from last year
                    </div>
                    <div>
                      <img ngSrc="../assets/images/explore/trend_green.svg" alt="Upward trend line" height="50"
                        width="99">
                    </div>
                  } @else {
                    <div class="uk-flex uk-flex-middle">
                      <span class="material-symbols-outlined down-arrow-color">arrow_downward</span>
                      <span
                        class="percentage-down-color">-{{ Math.abs(countriesWithStrategy[0] - countriesWithStrategy[1]) }}
                      %</span>&nbsp; from last year
                    </div>
                    <div>
                      <img ngSrc="../assets/images/explore/trend_red.svg" alt="Downward trend line" height="50"
                        width="99">
                    </div>
                  }
                </div>
              </div>
            </div>
          }

          @if (countriesWithMonitoring.length === 2) {
            <div>
              <div class="uk-card card-simple uk-card-small uk-card-body">
                <div>
                  <p>EU Countries with National FAIR Data Monitoring Initiatives</p>
                </div>
                <div class="number big uk-margin-medium-top">
                  <span class="uk-text-bold">{{ countriesWithMonitoring[1] }}%</span>
                </div>
                <div class="uk-flex uk-flex-bottom uk-flex-between uk-width-1-1">
                  @if (countriesWithMonitoring[1] >= countriesWithMonitoring[0]) {
                    <div class="uk-flex uk-flex-middle">
                      <span class="material-symbols-outlined up-arrow-color">arrow_upward</span>
                      <span
                        class="percentage-up-color">+{{ Math.abs(countriesWithMonitoring[0] - countriesWithMonitoring[1]) }}
                      %</span>&nbsp; from last year
                    </div>
                    <div>
                      <img ngSrc="../assets/images/explore/trend_green.svg" alt="Upward trend line" height="50"
                        width="99">
                    </div>
                  } @else {
                    <div class="uk-flex uk-flex-middle">
                      <span class="material-symbols-outlined down-arrow-color">arrow_downward</span>
                      <span
                        class="percentage-down-color">-{{ Math.abs(countriesWithMonitoring[0] - countriesWithMonitoring[1]) }}
                      %</span>&nbsp; from last year
                    </div>
                    <div>
                      <img ngSrc="../assets/images/explore/trend_red.svg" alt="Downward trend line" height="50"
                        width="99">
                    </div>
                  }
                </div>
              </div>
            </div>
          }

        </div>

        <div class="uk-margin-top">
          <span class="uk-text-bold">Data source:</span>&nbsp;
          Survey on National Contributions to EOSC and Open Science {{year}} -
          showing data for {{ year }}, except financial contributions, which reflect the previous year ({{+year-1}}).
        </div>

      </div>
    </div>

    <div class="uk-section uk-section-primary uk-preserve-color uk-section-small" #exportContent3>
      <div class="uk-container">

        <div class="uk-card uk-card-default visualisation-card uk-card-body">

          <ul class="uk-subnav uk-subnav-pill" data-uk-switcher="connect:#maps; animation: uk-animation-fade">
            <li><a class="uk-margin-remove-bottom" (click)="countryName = countryCode = comment = undefined">Policies</a></li>
            <li><a class="uk-margin-remove-bottom" (click)="countryName = countryCode = comment = undefined">Monitoring</a></li>
          </ul>

          <ul id="maps" class="uk-switcher uk-child-width-1-1 uk-grid-match" data-uk-grid>
            <li>
              <div data-uk-grid>
                <div class="uk-width-2-3@m uk-width-2-3@l uk-width-1-1@s">
                  <app-highcharts-category-map
                    [mapData]="questionsDataArray[0]" [height]="700" [smallScreen]="smallScreen"
                    [title]="'National Policy on FAIR Data'" [backgroundColor]="'#ffffff'"
                    [customLabelText]="'<span class=\'uk-text-xsmall\'><strong>'+participatingCountries[0] + ' out of '+ total[0] + '</strong> countries have a <br>national policy on FAIR Data</span>'"
                    [caption]="policesMapCaptions[2] + '<strong>Data source:</strong> Survey on National Contributions to EOSC and Open Science '+year+'.'"
                    (mapClick)="showComment(0, $event)">
                  </app-highcharts-category-map>
                </div>
                <div class="uk-width-1-3@m uk-width-1-3@l uk-width-1-1@s">
                  <div>
                    <h6>Start Exploring</h6>
                    <p>Click on a country to see what the survey reveals. Each one has its own story.</p>
                    <!--                <h6>Click on country for additional information</h6>-->
                    <div class="uk-flex uk-flex-middle uk-margin-medium-top">
                      @if (countryCode) {
                        <img ngSrc="survey-tool/assets/images/flags/{{countryCode}}-flag-round.png"
                          width="30" height="30" alt="Rounded flag of the selected country">
                      }
                      @if (countryName) {
                        <span class="uk-margin-small-left">{{ countryName }}</span>
                      }
                    </div>
                    @if (comment) {
                      <p [innerHTML]="comment"
                      class="uk-text-justify uk-text-small overflow-wrap-break-word"></p>
                    } @else {
                      --
                    }
                  </div>
                </div>
              </div>
            </li>
            <li>
              <div data-uk-grid>
                <div class="uk-width-2-3@m uk-width-2-3@l uk-width-1-1@s">
                  <app-highcharts-category-map
                    [mapData]="questionsDataArray[1]" [height]="700" [smallScreen]="smallScreen"
                    [title]="'National Monitoring on FAIR Data'" [backgroundColor]="'#ffffff'"
                    [customLabelText]="'<span class=\'uk-text-xsmall\'><strong>'+participatingCountries[1] + ' out of '+ total[1] + '</strong> countries have a <br>national monitoring on FAIR Data</span>'"
                    [caption]="monitoringMapCaptions[2] + '<strong>Data source:</strong> Survey on National Contributions to EOSC and Open Science '+year+'.'"
                    (mapClick)="showComment(1, $event)">
                  </app-highcharts-category-map>
                </div>
                <div class="uk-width-1-3@m uk-width-1-3@l uk-width-1-1@s">
                  <div>
                    <h6>Start Exploring</h6>
                    <p>Click on a country to see what the survey reveals. Each one has its own story.</p>
                    <!--                <h6>Click on country for additional information</h6>-->
                    <div class="uk-flex uk-flex-middle uk-margin-medium-top">
                      @if (countryCode) {
                        <img ngSrc="survey-tool/assets/images/flags/{{countryCode}}-flag-round.png"
                          width="30" height="30" alt="Rounded flag of the selected country">
                      }
                      @if (countryName) {
                        <span class="uk-margin-small-left">{{ countryName }}</span>
                      }
                    </div>
                    @if (comment) {
                      <p [innerHTML]="comment"
                      class="uk-text-justify uk-text-small overflow-wrap-break-word"></p>
                    } @else {
                      --
                    }
                  </div>
                </div>
              </div>
            </li>
          </ul>

        </div>

      </div>
    </div>

    <div class="uk-section uk-section-primary uk-preserve-color uk-section-small" #exportContent4>
      <div class="uk-container">

        <div class="uk-card uk-card-default visualisation-card uk-card-body">

          <ul class="uk-subnav uk-subnav-pill" data-uk-switcher="connect:#investments; animation: uk-animation-fade">
            <li><a class="uk-margin-remove-bottom">Overview</a></li>
            <li><a class="uk-margin-remove-bottom">Details</a></li>
          </ul>

          <ul id="investments" class="uk-switcher">
            <li>
              <div class="">
                <app-multi-chart [series]="bar" [categories]="['Number of countries per Investment Category']"
                  [titles]="barChartTitles" [reversedStacks]="false"
                  [stacking]="'normal'" [pointWidth]="75" [legendOptions]="legendOptions"
                  [customTooltip]="true" [yAxisLabels]="false" [height]="smallScreen ? 500 : 400"
                                 [caption]="'<p class=\'uk-text-justify\'>The graph illustrates the financial investments in Fair Data made by European countries. The investments are categorised in ranges to show the distribution and scale of funding.</p>' +
                                 '<p><strong>Data source: </strong>Survey on National Contributions to EOSC and Open Science '+year+' — for financial contributions the data reflect the previous year ('+(+year-1)+').</p>'">
                </app-multi-chart>
              </div>
            </li>
            <li>
              <div class="">
                <app-tree-graph [data]="treeGraph" [height]="700"
                                [title]="'Financial Investments in FAIR Data in '+ (+year-1)"
                                [caption]="'<p class=\'uk-text-justify\'>The graph illustrates the financial investments in Fair Data made by European countries. The investments are categorised in ranges to show the distribution and scale of funding.</p>' +
                            '<p><strong>Data source: </strong>Survey on National Contributions to EOSC and Open Science '+year+' — for financial contributions the data reflect the previous year ('+(+year-1)+').</p>'">
                </app-tree-graph>
              </div>
            </li>
          </ul>

        </div>

      </div>
    </div>

    <div class="uk-section uk-section-primary uk-preserve-color uk-section-xsmall" #exportContent5>
      <div class="uk-container">

        <div class="uk-child-width-1-2@m uk-child-width-1-2@l uk-child-width-1-1@s" data-uk-grid>
          <div>
            <div class="uk-card uk-card-default visualisation-card uk-card-body">
              <app-stacked-column [categories]="stackedColumnCategories" [series]="stackedColumnSeries1"
                                  [yAxis]="yAxisTitle"
                [title]="'Trend of Policies on FAIR Data among Research Performing Organisations'"
                [stacking]="'percent'" [plotFormat]="plotFormat" [pointFormat]="tooltipPointFormat"
                [stackLabels]="false" [yAxisLabelsFormat]="labelFormat" [xAxis]="xAxisTitle"
                [height]="700"
                                  [caption]="'<p class=\'uk-text-justify\'>The presented graph shows the adoption of FAIR Data policies among Research Performing Organisations (RPOs). It highlights the percentage of RPOs that have implemented policies supporting FAIR data principles, compared to those without such policies.</p>' +
                              '<p><strong>Data Source: </strong> Survey on National Contributions to EOSC and Open Science '+year+'.</p>'">
              </app-stacked-column>
            </div>
          </div>
          <div>
            <div class="uk-card uk-card-default visualisation-card uk-card-body">
              <app-stacked-column [categories]="stackedColumnCategories" [series]="stackedColumnSeries2"
                                  [yAxis]="yAxisTitle"
                [title]="'Trend of Policies on FAIR Data among Research Funding Organisations'"
                [stacking]="'percent'" [plotFormat]="plotFormat" [pointFormat]="tooltipPointFormat"
                [stackLabels]="false" [yAxisLabelsFormat]="labelFormat" [xAxis]="xAxisTitle"
                [height]="700"
                                  [caption]="'<p class=\'uk-text-justify\'>The presented graph shows on Research Funding Organisations (RFOs) and their commitment to FAIR Data policies. It illustrates the percentage of RFOs that have implemented FAIR data policies, alongside those that have not.</p>' +
                              '<p><strong>Data Source: </strong> Survey on National Contributions to EOSC and Open Science'+year+'.</p>'">
              </app-stacked-column>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>
</div>
